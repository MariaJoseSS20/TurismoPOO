{% extends "web/base.html" %}

{% block title %}Paquetes - Viajes Aventura{% endblock %}

{% block content %}
<div data-es-admin="{{ 'true' if session.usuario_rol == 'admin' else 'false' }}" id="paquetes-page">
<div class="card mb-5" style="background: linear-gradient(135deg, var(--primary-blue) 0%, var(--dark-blue) 100%); border: none;">
    <div class="card-body p-5 text-center text-white">
        <div class="d-flex justify-content-between align-items-center">
            <div class="flex-fill"></div>
            <div class="flex-fill text-center">
                <h1 class="display-4 fw-semibold mb-3 text-white">
                    <i class="bi bi-box-seam-fill"></i> Paquetes Turísticos
                </h1>
                <p class="lead mb-0 text-white-50">Encuentra el paquete perfecto para tu próxima aventura</p>
            </div>
            <div class="flex-fill text-end">
                {% if session.usuario_rol == 'admin' %}
                <button type="button" class="btn btn-light btn-lg" data-bs-toggle="modal" data-bs-target="#modalCrearPaquete">
                    <i class="bi bi-plus-circle"></i> Crear Paquete
                </button>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<div class="card mb-3">
    <div class="card-body p-4">
        <form id="form-buscar-paquetes" class="row g-3 align-items-end">
            <div class="col-md-2">
                <label class="form-label fw-bold text-primary small">Origen</label>
                <input type="text" class="form-control" id="origen" placeholder="Ej: Santiago" value="Punta Arenas">
            </div>
            <div class="col-md-2">
                <label class="form-label fw-bold text-primary small"><i class="bi bi-geo-alt text-danger"></i> Destino</label>
                <input type="text" class="form-control" id="destino" placeholder="Ej: París">
            </div>
            <div class="col-md-2">
                <label class="form-label fw-bold text-primary small"><i class="bi bi-calendar3"></i> Fecha Inicio</label>
                <input type="date" class="form-control" id="fecha_inicio" placeholder="Seleccionar fecha">
            </div>
            <div class="col-md-2">
                <label class="form-label fw-bold text-primary small"><i class="bi bi-calendar-check"></i> Fecha Fin</label>
                <input type="date" class="form-control" id="fecha_fin" placeholder="Seleccionar fecha">
            </div>
            <div class="col-md-3">
                <label class="form-label fw-bold text-primary small"><i class="bi bi-currency-dollar"></i> Rango de Precio</label>
                <div class="price-range-container" id="price-range-paquetes">
                    <div class="price-range-slider">
                        <div class="range-track"></div>
                        <input type="range" id="precio_min_slider" min="0" max="50000" step="1000" value="0">
                        <input type="range" id="precio_max_slider" min="0" max="50000" step="1000" value="50000">
                    </div>
                    <div class="price-range-values">
                        <div class="flex-fill">
                            <div class="price-value-label">Mínimo</div>
                            <div class="price-value" id="precio_min_display">$0</div>
                        </div>
                        <div class="flex-fill">
                            <div class="price-value-label">Máximo</div>
                            <div class="price-value" id="precio_max_display">$50.000</div>
                        </div>
                    </div>
                    <input type="hidden" id="precio_min" value="0">
                    <input type="hidden" id="precio_max" value="50000">
                </div>
            </div>
        </form>
    </div>
</div>

<div id="paquetes-container">
    <div class="text-center py-3">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Cargando...</span>
        </div>
        <p class="mt-2 text-muted small">Cargando paquetes...</p>
    </div>
</div>
</div>

{% if session.usuario_rol == 'admin' %}
<!-- Modal para Crear Paquete -->
<div class="modal fade" id="modalCrearPaquete" tabindex="-1" aria-labelledby="modalCrearPaqueteLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="modalCrearPaqueteLabel">
                    <i class="bi bi-plus-circle"></i> Crear Paquete
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="formCrearPaquete">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="modal_nombre" class="form-label fw-bold">Nombre <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="modal_nombre" name="nombre" required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="modal_origen" class="form-label fw-bold">Origen <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="modal_origen" name="origen" value="Punta Arenas" readonly required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="modal_fecha_inicio" class="form-label fw-bold">Fecha Inicio <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="modal_fecha_inicio" name="fecha_inicio" required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="modal_fecha_fin" class="form-label fw-bold">Fecha Fin <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="modal_fecha_fin" name="fecha_fin" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="modal_precio_total" class="form-label fw-bold">Precio Total <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="modal_precio_total" name="precio_total" step="0.01" min="0" readonly required>
                            <small class="text-muted"><i class="bi bi-info-circle"></i> Se calcula automáticamente según destino y fechas</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="modal_disponibles" class="form-label fw-bold">Cupos Disponibles <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="modal_disponibles" name="disponibles" min="0" value="20" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Destino <span class="text-danger">*</span></label>
                        <div class="border rounded p-3 overflow-auto" style="max-height: 200px;" id="destinos-container">
                            <div class="text-center text-muted">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="visually-hidden">Cargando...</span>
                                </div>
                                <p class="mt-2 mb-0">Cargando destinos...</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Crear Paquete
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

<!-- Modal para Editar Paquete -->
<div class="modal fade" id="modalEditarPaquete" tabindex="-1" aria-labelledby="modalEditarPaqueteLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title" id="modalEditarPaqueteLabel">
                    <i class="bi bi-pencil-square"></i> Editar Paquete
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <form id="formEditarPaquete">
                <div class="modal-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="modal_editar_nombre" class="form-label fw-bold">Nombre <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="modal_editar_nombre" name="nombre" required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="modal_editar_origen" class="form-label fw-bold">Origen</label>
                            <input type="text" class="form-control" id="modal_editar_origen" name="origen" value="Punta Arenas" readonly>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="modal_editar_fecha_inicio" class="form-label fw-bold">Fecha Inicio <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="modal_editar_fecha_inicio" name="fecha_inicio" required>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="modal_editar_fecha_fin" class="form-label fw-bold">Fecha Fin <span class="text-danger">*</span></label>
                            <input type="date" class="form-control" id="modal_editar_fecha_fin" name="fecha_fin" required>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="modal_editar_precio_total" class="form-label fw-bold">Precio Total <span class="text-danger">*</span></label>
                            <input type="number" class="form-control" id="modal_editar_precio_total" name="precio_total" step="0.01" min="0" readonly required>
                            <small class="text-muted"><i class="bi bi-info-circle"></i> Se calcula automáticamente según destino y fechas</small>
                        </div>
                        
                        <div class="col-md-6 mb-3">
                            <label for="modal_editar_disponibles" class="form-label fw-bold">Cupos Disponibles</label>
                            <input type="number" class="form-control" id="modal_editar_disponibles" name="disponibles" min="0" required>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label fw-bold">Destino <span class="text-danger">*</span></label>
                        <div class="border rounded p-3" style="max-height: 200px; overflow-y: auto;" id="destinos-container-editar">
                            <div class="text-center text-muted">
                                <div class="spinner-border spinner-border-sm" role="status">
                                    <span class="visually-hidden">Cargando...</span>
                                </div>
                                <p class="mt-2 mb-0">Cargando destinos...</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                        <i class="bi bi-x-circle"></i> Cancelar
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="bi bi-check-circle"></i> Guardar Cambios
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endif %}
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/paquetes.js') }}"></script>
{% endblock %}
